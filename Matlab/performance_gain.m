clear
close all
clc
extra = 0;
%{
Cordic length = 12
tail = 150
tail_i = 1
1. The soft error rate is 1.3069%
2. The soft error rate is 1.8538%
3. The soft error rate is 1.0958%
4. The soft error rate is 0.23891%
5. The soft error rate is 0.23619%
6. The soft error rate is 0.99151%
Extra Pattern:
1. The soft error rate is 3.0093%
2. The soft error rate is 3.8341%
3. The soft error rate is 1.1989%
4. The soft error rate is 3.9021%
5. The soft error rate is 2.8238%
6. The soft error rate is 1.7086%
7. The soft error rate is 1.3535%
8. The soft error rate is 1.3663%
9. The soft error rate is 1.0404%
10. The soft error rate is 1.9518%
11. The soft error rate is 0.21467%
12. The soft error rate is 0.24721%
13. The soft error rate is 0.17957%
14. The soft error rate is 0.22964%
15. The soft error rate is 0.25275%
16. The soft error rate is 1.323%
17. The soft error rate is 0.38555%
18. The soft error rate is 0.2507%
19. The soft error rate is 0.47409%
20. The soft error rate is 0.43521%


Cordic length = 15
tail = tail_i = 16
1. The soft error rate is 1.6455%
2. The soft error rate is 1.1534%
3. The soft error rate is 0.72909%
4. The soft error rate is 0.19419%
5. The soft error rate is 0.16763%
6. The soft error rate is 0.24935%
%}















%{
iter=6:
S3.2
1. The soft error rate is 72.2815%
2. The soft error rate is 67.9268%
3. The soft error rate is 43.7904%
4. The soft error rate is 32.3847%
5. The soft error rate is 30.1081%
6. The soft error rate is 34.981%
Extra Pattern:
1. The soft error rate is 51.9159%
2. The soft error rate is 49.7701%
3. The soft error rate is 41.8873%
4. The soft error rate is 50.3473%
5. The soft error rate is 59.4556%
6. The soft error rate is 48.1416%
7. The soft error rate is 57.0646%
8. The soft error rate is 42.989%
9. The soft error rate is 69.967%
10. The soft error rate is 46.0796%
11. The soft error rate is 31.0976%
12. The soft error rate is 33.36%
13. The soft error rate is 32.2078%
14. The soft error rate is 30.5235%
15. The soft error rate is 29.4044%
16. The soft error rate is 29.8519%
17. The soft error rate is 32.6288%
18. The soft error rate is 31.2021%
19. The soft error rate is 33.2354%
20. The soft error rate is 29.7385%
S3.6
1. The soft error rate is 1.4536%
2. The soft error rate is 1.1737%
3. The soft error rate is 1.4781%
4. The soft error rate is 0.2448%
5. The soft error rate is 0.20144%
6. The soft error rate is 1.3119%
Extra Pattern:
1. The soft error rate is 2.1839%
2. The soft error rate is 3.0176%
3. The soft error rate is 1.1111%
4. The soft error rate is 0.8727%
5. The soft error rate is 3.752%
6. The soft error rate is 1.8433%
7. The soft error rate is 1.3501%
8. The soft error rate is 1.1246%
9. The soft error rate is 1.6386%
10. The soft error rate is 1.473%
11. The soft error rate is 0.25624%
12. The soft error rate is 0.33582%
13. The soft error rate is 0.1942%
14. The soft error rate is 0.21106%
15. The soft error rate is 0.25275%
16. The soft error rate is 0.15567%
17. The soft error rate is 0.31124%
18. The soft error rate is 0.211%
19. The soft error rate is 0.39042%
20. The soft error rate is 0.25849%
S3.10
1. The soft error rate is 0.85156%
2. The soft error rate is 1.0719%
3. The soft error rate is 1.0051%
4. The soft error rate is 0.1667%
5. The soft error rate is 0.18343%
6. The soft error rate is 0.83634%
Extra Pattern:
1. The soft error rate is 1.3352%
2. The soft error rate is 1.9982%
3. The soft error rate is 1.0093%
4. The soft error rate is 0.7286%
5. The soft error rate is 2.2516%
6. The soft error rate is 1.0902%
7. The soft error rate is 0.72888%
8. The soft error rate is 0.91433%
9. The soft error rate is 3.7074%
10. The soft error rate is 1.4138%
11. The soft error rate is 0.12702%
12. The soft error rate is 0.30407%
13. The soft error rate is 0.16293%
14. The soft error rate is 0.18403%
15. The soft error rate is 0.35773%
16. The soft error rate is 1.7422%
17. The soft error rate is 0.20188%
18. The soft error rate is 0.13915%
19. The soft error rate is 0.20069%
20. The soft error rate is 0.36141%
S3.14 (v)
1. The soft error rate is 0.86058%
2. The soft error rate is 1.0221%
3. The soft error rate is 0.89783%
4. The soft error rate is 0.14744%
5. The soft error rate is 0.16853%
6. The soft error rate is 0.85472%
Extra Pattern:
1. The soft error rate is 1.1994%
2. The soft error rate is 1.8777%
3. The soft error rate is 1.008%
4. The soft error rate is 0.64804%
5. The soft error rate is 1.6849%
6. The soft error rate is 1.0886%
7. The soft error rate is 0.73399%
8. The soft error rate is 0.8934%
9. The soft error rate is 4.136%
10. The soft error rate is 1.5885%
11. The soft error rate is 0.12469%
12. The soft error rate is 0.27967%
13. The soft error rate is 0.16516%
14. The soft error rate is 0.17867%
15. The soft error rate is 0.35392%
16. The soft error rate is 1.1658%
17. The soft error rate is 0.20662%
18. The soft error rate is 0.14132%
19. The soft error rate is 0.21747%
20. The soft error rate is 0.33384%
S3.16
1. The soft error rate is 0.86101%
2. The soft error rate is 1.0213%
3. The soft error rate is 0.89691%
4. The soft error rate is 0.14721%
5. The soft error rate is 0.16389%
6. The soft error rate is 0.85678%
Extra Pattern:
1. The soft error rate is 1.197%
2. The soft error rate is 1.8785%
3. The soft error rate is 1.0203%
4. The soft error rate is 0.6481%
5. The soft error rate is 1.682%
6. The soft error rate is 1.089%
7. The soft error rate is 0.73379%
8. The soft error rate is 0.89234%
9. The soft error rate is 4.164%
10. The soft error rate is 1.5906%
11. The soft error rate is 0.11981%
12. The soft error rate is 0.27969%
13. The soft error rate is 0.16443%
14. The soft error rate is 0.17878%
15. The soft error rate is 0.35411%
16. The soft error rate is 1.1787%
17. The soft error rate is 0.20666%
18. The soft error rate is 0.13652%
19. The soft error rate is 0.21406%
20. The soft error rate is 0.33459%
S3.22
1. The soft error rate is 0.8639%
2. The soft error rate is 1.0264%
3. The soft error rate is 0.89353%
4. The soft error rate is 0.14746%
5. The soft error rate is 0.16345%
6. The soft error rate is 0.85446%
Extra Pattern:
1. The soft error rate is 1.2004%
2. The soft error rate is 1.8915%
3. The soft error rate is 1.0182%
4. The soft error rate is 0.64802%
5. The soft error rate is 1.6816%
6. The soft error rate is 1.0867%
7. The soft error rate is 0.73396%
8. The soft error rate is 0.90032%
9. The soft error rate is 4.1713%
10. The soft error rate is 1.5897%
11. The soft error rate is 0.12013%
12. The soft error rate is 0.27939%
13. The soft error rate is 0.16484%
14. The soft error rate is 0.17844%
15. The soft error rate is 0.35441%
16. The soft error rate is 1.173%
17. The soft error rate is 0.20727%
18. The soft error rate is 0.13643%
19. The soft error rate is 0.21398%
20. The soft error rate is 0.33451%
%}

% Change the packet number (1-6)
for p = 1:6
packet_no = p;

switch packet_no
    case 1
        file_R = importdata('.\Result\out_R_SNR10_P1_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_P1_result.txt');
        llr_gld = importdata('.\llr_gld\packet_1\llr_gld.mat');
    case 2
        file_R = importdata('.\Result\out_R_SNR10_P2_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_P2_result.txt');
        llr_gld = importdata('.\llr_gld\packet_2\llr_gld.mat');
    case 3
        file_R = importdata('.\Result\out_R_SNR10_P3_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_P3_result.txt');
        llr_gld = importdata('.\llr_gld\packet_3\llr_gld.mat');
    case 4
        file_R = importdata('.\Result\out_R_SNR15_P4_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_P4_result.txt');
        llr_gld = importdata('.\llr_gld\packet_4\llr_gld.mat');
    case 5
        file_R = importdata('.\Result\out_R_SNR15_P5_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_P5_result.txt');
        llr_gld = importdata('.\llr_gld\packet_5\llr_gld.mat');
    case 6
        file_R = importdata('.\Result\out_R_SNR15_P6_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_P6_result.txt');
        llr_gld = importdata('.\llr_gld\packet_6\llr_gld.mat');
    otherwise
        file_R = importdata('.\Result\out_R_SNR10_P1_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_P1_result.txt');
        llr_gld = importdata('.\llr_gld\packet_1\llr_gld.mat');
end

no_RE_per_packet = 1000;
error_packet = 0;

llr_dut_buffer = [];
flag = 0;
for index_RE = 1:size(file_R,1)
if (index_RE == 8)
    flag = 0;
end
    %disp(['index of RE = ', num2str(index_RE)]);

    error_RE = 0;

    % ========== R ========== %
    R_s = string(file_R(index_RE,:));

    dataDec = sscanf(R_s, '%5x');
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %dataDec = dataDec - mod(dataDec, 64);
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    index = dataDec >= 2^19;
    dataDec(index) = dataDec(index) - 2^20;

    R44_real = dataDec(1)/2^16;
    R34_imag = dataDec(2)/2^16;
    R34_real = dataDec(3)/2^16;
    R24_imag = dataDec(4)/2^16;
    R24_real = dataDec(5)/2^16;
    R14_imag = dataDec(6)/2^16;
    R14_real = dataDec(7)/2^16;
    R33_real = dataDec(8)/2^16;
    R23_imag = dataDec(9)/2^16;
    R23_real = dataDec(10)/2^16;
    R13_imag = dataDec(11)/2^16;
    R13_real = dataDec(12)/2^16;
    R22_real = dataDec(13)/2^16;
    R12_imag = dataDec(14)/2^16;
    R12_real = dataDec(15)/2^16;
    R11_real = dataDec(16)/2^16;

    R11 = R11_real;
    R12 = R12_real+j*R12_imag;
    R13 = R13_real+j*R13_imag;
    R14 = R14_real+j*R14_imag;
    R22 = R22_real;
    R23 = R23_real+j*R23_imag;
    R24 = R24_real+j*R24_imag;
    R33 = R33_real;
    R34 = R34_real+j*R34_imag;
    R44 = R44_real;

    R = [R11 R12 R13 R14;
           0 R22 R23 R24;
           0   0 R33 R34;
           0   0   0 R44;];
    % ======================= %

    % ========== y_hat ========== %
    y_hat_s = string(file_y_hat(index_RE,:));

    dataDec = sscanf(y_hat_s, '%5x');
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %dataDec = dataDec - mod(dataDec, 64);
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    index = dataDec >= 2^19;
    dataDec(index) = dataDec(index) - 2^20;

    y_hat_4_imag = dataDec(1)/2^16;
    y_hat_4_real = dataDec(2)/2^16;
    y_hat_3_imag = dataDec(3)/2^16;
    y_hat_3_real = dataDec(4)/2^16;
    y_hat_2_imag = dataDec(5)/2^16;
    y_hat_2_real = dataDec(6)/2^16;
    y_hat_1_imag = dataDec(7)/2^16;
    y_hat_1_real = dataDec(8)/2^16;
    % =========================== %

    Qy1 = y_hat_1_real+j*y_hat_1_imag;
    Qy2 = y_hat_2_real+j*y_hat_2_imag;
    Qy3 = y_hat_3_real+j*y_hat_3_imag;
    Qy4 = y_hat_4_real+j*y_hat_4_imag;

    Qy = [Qy1;
          Qy2;
          Qy3;
          Qy4;];

    [llr_dut, ~] = nrMLD(Qy, R, 'no_use', 0, 'soft');
    llr_dut_buffer = [llr_dut_buffer; llr_dut'];

    for i = 1:8
if (flag)
    disp(['llr_dut = ', num2str(llr_dut(i)), ', llr_gld = ', num2str(llr_gld(index_RE, i))]);
end
        if ( sign(llr_dut(i)) == sign(llr_gld(index_RE,i)) )

            if (abs(llr_dut(i)) >= abs(llr_gld(index_RE,i)))

                error_RE = error_RE;

            else

                error_RE = error_RE + (abs(llr_gld(index_RE,i))-abs(llr_dut(i)))/abs(llr_gld(index_RE,i));
%                error_RE = error_RE + (abs(llr_gld(index_RE,i))-abs(llr_dut(i)));

            end

        else

            error_RE = error_RE + abs(llr_dut(i)-llr_gld(index_RE,i))/abs(llr_gld(index_RE,i));
%            error_RE = error_RE + abs(llr_dut(i)-llr_gld(index_RE,i));

        end

    end

    error_RE = error_RE/8;
    error_packet = error_packet + error_RE;

end

error_packet = error_packet/no_RE_per_packet;
disp([num2str(p), '. The soft error rate is ', num2str(error_packet*100),'%'])
end

if (extra)

disp(['Extra Pattern:'])

for p = 1:20
packet_no = p;

switch packet_no
    case 1
        file_R = importdata('.\Result\out_R_SNR10_E1_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E1_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E1\llr_gld.mat');
    case 2
        file_R = importdata('.\Result\out_R_SNR10_E2_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E2_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E2\llr_gld.mat');
    case 3
        file_R = importdata('.\Result\out_R_SNR10_E3_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E3_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E3\llr_gld.mat');
    case 4
        file_R = importdata('.\Result\out_R_SNR10_E4_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E4_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E4\llr_gld.mat');
    case 5
        file_R = importdata('.\Result\out_R_SNR10_E5_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E5_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E5\llr_gld.mat');
    case 6
        file_R = importdata('.\Result\out_R_SNR10_E6_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E6_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E6\llr_gld.mat');
    case 7
        file_R = importdata('.\Result\out_R_SNR10_E7_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E7_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E7\llr_gld.mat');
    case 8
        file_R = importdata('.\Result\out_R_SNR10_E8_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E8_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E8\llr_gld.mat');
    case 9
        file_R = importdata('.\Result\out_R_SNR10_E9_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E9_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E9\llr_gld.mat');
    case 10
        file_R = importdata('.\Result\out_R_SNR10_E10_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E10_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E10\llr_gld.mat');
    case 11
        file_R = importdata('.\Result\out_R_SNR15_E1_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E1_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E1\llr_gld.mat');
    case 12
        file_R = importdata('.\Result\out_R_SNR15_E2_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E2_result.txt', " ", 1000);
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E2\llr_gld.mat');
    case 13
        file_R = importdata('.\Result\out_R_SNR15_E3_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E3_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E3\llr_gld.mat');
    case 14
        file_R = importdata('.\Result\out_R_SNR15_E4_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E4_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E4\llr_gld.mat');
    case 15
        file_R = importdata('.\Result\out_R_SNR15_E5_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E5_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E5\llr_gld.mat');
    case 16
        file_R = importdata('.\Result\out_R_SNR15_E6_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E6_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E6\llr_gld.mat');
    case 17
        file_R = importdata('.\Result\out_R_SNR15_E7_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E7_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E7\llr_gld.mat');
    case 18
        file_R = importdata('.\Result\out_R_SNR15_E8_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E8_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E8\llr_gld.mat');
    case 19
        file_R = importdata('.\Result\out_R_SNR15_E9_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E9_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E9\llr_gld.mat');
    case 20
        file_R = importdata('.\Result\out_R_SNR15_E10_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR15_E10_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR15\E10\llr_gld.mat');
    otherwise
        file_R = importdata('.\Result\out_R_SNR10_E1_result.txt');
        file_y_hat = importdata('.\Result\out_y_hat_SNR10_E1_result.txt');
        llr_gld = importdata('..\Extra_Pattern\Extra_Pattern\SNR10\E1\llr_gld.mat');
end

no_RE_per_packet = 1000;
error_packet = 0;

llr_dut_buffer = [];
error_buf = [];
for index_RE = 1:size(file_R,1)
%flag = index_RE==776;
flag=0;
    %disp(['index of RE = ', num2str(index_RE)]);

    error_RE = 0;

    % ========== R ========== %
    R_s = string(file_R(index_RE,:));

    dataDec = sscanf(R_s, '%5x');
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %dataDec = dataDec - mod(dataDec, 64);
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    index = dataDec >= 2^19;
    dataDec(index) = dataDec(index) - 2^20;

    R44_real = dataDec(1)/2^16;
    R34_imag = dataDec(2)/2^16;
    R34_real = dataDec(3)/2^16;
    R24_imag = dataDec(4)/2^16;
    R24_real = dataDec(5)/2^16;
    R14_imag = dataDec(6)/2^16;
    R14_real = dataDec(7)/2^16;
    R33_real = dataDec(8)/2^16;
    R23_imag = dataDec(9)/2^16;
    R23_real = dataDec(10)/2^16;
    R13_imag = dataDec(11)/2^16;
    R13_real = dataDec(12)/2^16;
    R22_real = dataDec(13)/2^16;
    R12_imag = dataDec(14)/2^16;
    R12_real = dataDec(15)/2^16;
    R11_real = dataDec(16)/2^16;

    R11 = R11_real;
    R12 = R12_real+j*R12_imag;
    R13 = R13_real+j*R13_imag;
    R14 = R14_real+j*R14_imag;
    R22 = R22_real;
    R23 = R23_real+j*R23_imag;
    R24 = R24_real+j*R24_imag;
    R33 = R33_real;
    R34 = R34_real+j*R34_imag;
    R44 = R44_real;

    R = [R11 R12 R13 R14;
           0 R22 R23 R24;
           0   0 R33 R34;
           0   0   0 R44;];
    % ======================= %

    % ========== y_hat ========== %
    y_hat_s = string(file_y_hat(index_RE,:));

    dataDec = sscanf(y_hat_s, '%5x');
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %dataDec = dataDec - mod(dataDec, 64);
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    index = dataDec >= 2^19;
    dataDec(index) = dataDec(index) - 2^20;

    y_hat_4_imag = dataDec(1)/2^16;
    y_hat_4_real = dataDec(2)/2^16;
    y_hat_3_imag = dataDec(3)/2^16;
    y_hat_3_real = dataDec(4)/2^16;
    y_hat_2_imag = dataDec(5)/2^16;
    y_hat_2_real = dataDec(6)/2^16;
    y_hat_1_imag = dataDec(7)/2^16;
    y_hat_1_real = dataDec(8)/2^16;
    % =========================== %

    Qy1 = y_hat_1_real+j*y_hat_1_imag;
    Qy2 = y_hat_2_real+j*y_hat_2_imag;
    Qy3 = y_hat_3_real+j*y_hat_3_imag;
    Qy4 = y_hat_4_real+j*y_hat_4_imag;

    Qy = [Qy1;
          Qy2;
          Qy3;
          Qy4;];

    [llr_dut, ~] = nrMLD(Qy, R, 'no_use', 0, 'soft');
    llr_dut_buffer = [llr_dut_buffer; llr_dut'];

    for i = 1:8
if (flag)
    disp(['llr_dut = ', num2str(llr_dut(i)), ', llr_gld = ', num2str(llr_gld(index_RE, i))]);
end
        if ( sign(llr_dut(i)) == sign(llr_gld(index_RE,i)) )

            if (abs(llr_dut(i)) >= abs(llr_gld(index_RE,i)))

                error_RE = error_RE;

            else

                error_RE = error_RE + (abs(llr_gld(index_RE,i))-abs(llr_dut(i)))/abs(llr_gld(index_RE,i));
%                error_RE = error_RE + (abs(llr_gld(index_RE,i))-abs(llr_dut(i)));

            end

        else

            error_RE = error_RE + abs(llr_dut(i)-llr_gld(index_RE,i))/abs(llr_gld(index_RE,i));
%            error_RE = error_RE + abs(llr_dut(i)-llr_gld(index_RE,i));

        end

    end
    if (flag)
        error_RE
    end

    error_RE = error_RE/8;
    if (flag)
        error_RE
    end
    %error_buf = [error_buf error_RE];
    error_packet = error_packet + error_RE;

end

error_packet = error_packet/no_RE_per_packet;
disp([num2str(p), '. The soft error rate is ', num2str(error_packet*100),'%'])
end
end
